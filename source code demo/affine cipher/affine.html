<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Affine Cipher - M√£ h√≥a Affine</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#1e40af',
            success: '#10b981',
            error: '#ef4444',
            warning: '#f59e0b'
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .input-focus:focus {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }
  </style>
</head>
<body class="gradient-bg min-h-screen py-8 px-4">
  <div class="max-w-4xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-white mb-2">üîê Affine Cipher</h1>
      <p class="text-blue-100 text-lg">M√£ h√≥a v√† gi·∫£i m√£ v·ªõi Affine Cipher - H·ªó tr·ª£ 95 k√Ω t·ª± ASCII</p>
    </div>

    <!-- Main Card -->
    <div class="glass-effect rounded-2xl p-8 shadow-2xl">
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Input Section -->
        <div class="space-y-6">
          <div>
            <label class="block text-white font-semibold mb-3 text-lg">
              üìù Chu·ªói nh·∫≠p v√†o
            </label>
            <textarea 
              id="inputText" 
              class="w-full p-4 rounded-xl border-2 border-gray-300 input-focus transition-all duration-200 resize-none h-32 text-gray-800"
              placeholder="Nh·∫≠p vƒÉn b·∫£n c·∫ßn m√£ h√≥a ho·∫∑c gi·∫£i m√£..."
            ></textarea>
          </div>

          <!-- Key Inputs -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-white font-semibold mb-2">
                üîë Kh√≥a a
              </label>
              <input 
                type="number" 
                id="keyA" 
                value="7" 
                oninput="checkKeyA()"
                class="w-full p-3 rounded-lg border-2 border-gray-300 input-focus transition-all duration-200 text-gray-800"
              >
              <p class="text-xs text-blue-100 mt-1">Ph·∫£i nguy√™n t·ªë c√πng nhau v·ªõi 95</p>
            </div>
            <div>
              <label class="block text-white font-semibold mb-2">
                üîë Kh√≥a b
              </label>
              <input 
                type="number" 
                id="keyB" 
                value="3"
                class="w-full p-3 rounded-lg border-2 border-gray-300 input-focus transition-all duration-200 text-gray-800"
              >
              <p class="text-xs text-blue-100 mt-1">C√≥ th·ªÉ l√† b·∫•t k·ª≥ s·ªë nguy√™n n√†o</p>
            </div>
          </div>

          <!-- Key Validation -->
          <div id="keyAHint" class="p-3 rounded-lg min-h-[60px] flex items-center"></div>

          <!-- Action Buttons -->
          <div class="flex gap-4">
            <button 
              onclick="encrypt()" 
              class="flex-1 bg-primary hover:bg-secondary text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
            >
              üîí M√£ h√≥a
            </button>
            <button 
              onclick="decrypt()" 
              class="flex-1 bg-success hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg"
            >
              üîì Gi·∫£i m√£
            </button>
          </div>
        </div>

        <!-- Output Section -->
        <div class="space-y-6">
          <div>
            <label class="block text-white font-semibold mb-3 text-lg">
              üì§ K·∫øt qu·∫£
            </label>
            <div 
              id="output" 
              class="w-full p-4 rounded-xl bg-white/10 border-2 border-white/20 min-h-[200px] text-white font-semibold text-sm whitespace-pre-wrap break-all"
            >
              K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y
            </div>
          </div>

          <!-- Info Panel -->
          <div class="bg-white/10 rounded-xl p-4 border border-white/20">
            <h3 class="text-white font-semibold mb-2">‚ÑπÔ∏è Th√¥ng tin thu·∫≠t to√°n</h3>
            <ul class="text-blue-100 text-sm space-y-1">
              <li>‚Ä¢ H·ªó tr·ª£ 95 k√Ω t·ª± ASCII (t·ª´ space ƒë·∫øn ~)</li>
              <li>‚Ä¢ C√¥ng th·ª©c m√£ h√≥a: C = (aP + b) mod 95</li>
              <li>‚Ä¢ C√¥ng th·ª©c gi·∫£i m√£: P = a‚Åª¬π(C - b) mod 95</li>
              <li>‚Ä¢ Kh√≥a 'a' ph·∫£i nguy√™n t·ªë c√πng nhau v·ªõi 95</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-8 text-blue-100">
      <p class="text-sm">Affine Cipher Demo - H·ªó tr·ª£ ch·ªØ c√°i, k√Ω t·ª± ƒë·∫∑c bi·ªát v√† s·ªë</p>
    </div>
  </div>

  <script>
    const CHAR_START = 32; // kho·∫£ng tr·∫Øng
    const CHAR_END = 126;  // ~
    const CHAR_RANGE = CHAR_END - CHAR_START + 1; // 95 k√Ω t·ª±

    // gcd
    function gcd(a, b) {
      return b === 0 ? a : gcd(b, a % b);
    }

    // ngh·ªãch ƒë·∫£o modulo
    function modInverse(a, m) {
      a = ((a % m) + m) % m;
      for (let x = 1; x < m; x++) {
        if ((a * x) % m === 1) return x;
      }
      return null;
    }

    // li·ªát k√™ t·∫•t c·∫£ gi√° tr·ªã a h·ª£p l·ªá
    function validAValues() {
      let list = [];
      for (let i = 1; i < CHAR_RANGE; i++) {
        if (gcd(i, CHAR_RANGE) === 1) list.push(i);
      }
      return list;
    }

    function checkKeyA() {
      let a = parseInt(document.getElementById("keyA").value);
      let hintDiv = document.getElementById("keyAHint");

      if (isNaN(a)) {
        hintDiv.innerHTML = "<div class='bg-error/20 border border-error/30 rounded-lg p-3'><span class='text-red-200 font-medium'>‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë cho kh√≥a a</span></div>";
        return;
      }

      if (gcd(a, CHAR_RANGE) !== 1) {
        hintDiv.innerHTML = "<div class='bg-error/20 border border-error/30 rounded-lg p-3'>" +
          "<span class='text-red-200 font-medium'>‚ùå a = " + a + " kh√¥ng h·ª£p l·ªá</span><br>" +
          "<span class='text-red-100 text-sm'>üëâ C√°c gi√° tr·ªã a h·ª£p l·ªá: " + validAValues().slice(0, 20).join(", ") + "...</span></div>";
      } else {
        hintDiv.innerHTML = "<div class='bg-success/20 border border-success/30 rounded-lg p-3'>" +
          "<span class='text-green-200 font-medium'>‚úÖ H·ª£p l·ªá (gcd(" + a + ", " + CHAR_RANGE + ") = 1)</span></div>";
      }
    }

    function encrypt() {
      let text = document.getElementById("inputText").value;
      let a = parseInt(document.getElementById("keyA").value);
      let b = parseInt(document.getElementById("keyB").value);

      if (gcd(a, CHAR_RANGE) !== 1) {
        document.getElementById("output").innerHTML = "<div class='text-red-300 font-semibold'>‚ùå L·ªói: Kh√≥a 'a' kh√¥ng h·ª£p l·ªá!</div>";
        return;
      }

      let result = "";
      for (let char of text) {
        let code = char.charCodeAt(0);
        if (code >= CHAR_START && code <= CHAR_END) {
          let P = code - CHAR_START;
          let C = (a * P + b) % CHAR_RANGE;
          result += String.fromCharCode(C + CHAR_START);
        } else {
          result += char;
        }
      }
      document.getElementById("output").innerHTML = "<div class='text-blue-200 font-semibold mb-2'>üîí B·∫£n m√£:</div><div class='text-white'>" + result + "</div>";
    }

    function decrypt() {
      let text = document.getElementById("inputText").value;
      let a = parseInt(document.getElementById("keyA").value);
      let b = parseInt(document.getElementById("keyB").value);

      if (gcd(a, CHAR_RANGE) !== 1) {
        document.getElementById("output").innerHTML = "<div class='text-red-300 font-semibold'>‚ùå L·ªói: Kh√≥a 'a' kh√¥ng h·ª£p l·ªá!</div>";
        return;
      }

      let a_inv = modInverse(a, CHAR_RANGE);
      if (a_inv === null) {
        document.getElementById("output").innerHTML = "<div class='text-red-300 font-semibold'>‚ùå L·ªói: Kh√¥ng t√¨m ƒë∆∞·ª£c ngh·ªãch ƒë·∫£o modulo!</div>";
        return;
      }

      let result = "";
      for (let char of text) {
        let code = char.charCodeAt(0);
        if (code >= CHAR_START && code <= CHAR_END) {
          let C = code - CHAR_START;
          let P = (a_inv * (C - b + CHAR_RANGE)) % CHAR_RANGE;
          result += String.fromCharCode(P + CHAR_START);
        } else {
          result += char;
        }
      }
      document.getElementById("output").innerHTML = "<div class='text-green-200 font-semibold mb-2'>üîì B·∫£n r√µ:</div><div class='text-white'>" + result + "</div>";
    }

    // hi·ªÉn th·ªã g·ª£i √Ω ngay khi load
    window.onload = checkKeyA;
  </script>
</body>
</html>
